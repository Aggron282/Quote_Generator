<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Window Knight | Smart Quote</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html{
      margin: 0;
      padding: 0;
    }
    body {
       background-image: linear-gradient(to right bottom,  rgba(0, 35, 50, 0.95), rgba(0, 50, 70, 0.95)), url('./../static/miss2.png');
      color: #fff;
      background-size: cover;
      font-family: 'Teko', sans-serif;
      padding: 40px;
    }
    h1 {
      font-size: 60px;
      font-weight: 700;
      margin-bottom: 30px;
    }
    .form-step {
      display: none;
    }
    #quoteForm{
      justify-self:center;
      background:rgba(0, 35, 50, 0.95);
      align-self: center;
      padding:50px;
      border-radius:10px;
      width:100%;

    }
    .form-step.active {
      display: block;
    }
    .progress-bar {
      font-size:20px;
      height: 40px;
      font-weight: bold;
      background: linear-gradient(90deg, #00b4d8, #1de9b6);
    }
    .progress{
      height:40px;
    }
    .pulse-upload {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: #00e1ff;
      animation: pulse 2s infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      margin: auto;
      box-shadow: 0 0 10px #00e1ff;
    }
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(0, 225, 255, 0.7);
      }
      70% {
        box-shadow: 0 0 0 25px rgba(0, 225, 255, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(0, 225, 255, 0);
      }
    }
    
    .thumb-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    grid-gap: 40px
    }
    .thumb {
      width: 100px;
      height: 100px;
      margin: 10px;
      position: relative;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: crimson;
      color: white;
      border: none;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      font-size: 14px;
      cursor: pointer;
      line-height: 1;
    }
    .link{
      font-size:25px;
      text-decoration: none;
      color:white;
      border-bottom: 2px solid white;
    }
    .upload-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  align-items: flex-start;
  justify-content: center;
  margin-top: 30px;
}

.upload-left {
  flex: 0 0 160px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

.upload-right {
  flex: 1;
  
  gap: 15px;
}

.upload-right .thumb {
  width: 100%;
  height: 100px;
}

  </style>
</head>
<body>
<div class="container">
  <a href="https://www.thewindowknight.com"class="link">Main Site</a>
  <h1 class="text-center">Smart Window Cleaning Quote</h1>
  <div class="progress mb-4">
    <div class="progress-bar" id="formProgress" style="width: 33%">Step 1 of 3</div>
  </div>
  <form id="quoteForm" method="POST" enctype="multipart/form-data">
    <!-- Step 1 -->
    <div class="form-step active">
      <div class="mb-3"><label>Name</label><input type="text" name="name" class="form-control" required></div>
      <div class="mb-3"><label>Email</label><input type="email" name="email" class="form-control" required></div>
      <div class="mb-3"><label>Phone</label><input type="tel" name="phone" class="form-control" required></div>
      <div class="mb-3"><label>Address</label><input type="text" name="address" class="form-control" required></div>
    </div>
    <!-- Step 2 -->
    <div class="form-step">
      <div class="mb-3"><label>Small Panes</label><input type="number" name="small_panes" class="form-control" value="0"></div>
      <div class="mb-3"><label>Medium Panes</label><input type="number" name="medium_panes" class="form-control" value="0"></div>
      <div class="mb-3"><label>Large Panes</label><input type="number" name="large_panes" class="form-control" value="0"></div>
      <div class="mb-3"><label>Notes About the Job</label><textarea name="job_notes" rows="4" class="form-control"></textarea></div>
    </div>
    <!-- Step 3 -->
    <!-- Step 3 -->
<div class="form-step">
  <div class="upload-grid">
    <div class="upload-left">
      <div class="pulse-upload" onclick="document.getElementById('photosInput').click()">Upload</div>
      <input type="file" name="photos" id="photosInput" multiple accept="image/*" class="d-none" onchange="previewPhotos(event)">
    </div>
    <div class="upload-right">
      <div class="thumb-container" id="thumbContainer"></div>
    </div>
  </div>
</div>

    <div class="d-flex justify-content-between mt-4">
      <button type="button" class="btn btn-outline-light" id="prevBtn" onclick="changeStep(-1)" disabled>Back</button>
      <button type="button" class="btn btn-info" id="nextBtn" onclick="changeStep(1)">Next</button>
      <button type="submit" class="btn btn-success d-none" id="submitBtn">Submit Quote</button>
    </div>
  </form>
</div>
<script>
  let currentStep = 0;
  const steps = document.querySelectorAll('.form-step');
  const progressBar = document.getElementById('formProgress');

  function changeStep(step) {
    
      if (step === 1 && !validateCurrentStep())  return;

    steps[currentStep].classList.remove('active');
    currentStep += step;
    steps[currentStep].classList.add('active');
    document.getElementById('prevBtn').disabled = currentStep === 0;
    document.getElementById('nextBtn').classList.toggle('d-none', currentStep === steps.length - 1);
    document.getElementById('submitBtn').classList.toggle('d-none', currentStep !== steps.length - 1);
    progressBar.style.width = `${((currentStep + 1) / steps.length) * 100}%`;
    progressBar.textContent = `Step ${currentStep + 1} of ${steps.length}`;
  }

  let uploadedFiles = [];

function previewPhotos(event) {
  const newFiles = [...event.target.files];
  uploadedFiles = uploadedFiles.concat(newFiles); // accumulate
  
  const container = document.getElementById('thumbContainer');
  container.innerHTML = '';

  uploadedFiles.forEach((file, index) => {
    const reader = new FileReader();
    reader.onload = function(e) {
      const div = document.createElement('div');
      div.className = 'thumb';
      div.innerHTML = `
        <img src="${e.target.result}"/>
        <button type="button" class="delete-btn" onclick="removePhoto(${index})">&times;</button>
      `;
      container.appendChild(div);
    };
    reader.readAsDataURL(file);
  });

  // Reset input so selecting same file again still triggers change
  event.target.value = '';
}

function removePhoto(index) {
  uploadedFiles.splice(index, 1); // remove selected index
  const dt = new DataTransfer();
  uploadedFiles.forEach(file => dt.items.add(file));
  document.getElementById('photosInput').files = dt.files;

  // Rebuild the preview
  previewPhotos({ target: { files: dt.files } });
}

function validateCurrentStep() {
  if (currentStep === 0) {
    const name = document.querySelector('[name="name"]').value.trim();
    const email = document.querySelector('[name="email"]').value.trim();
    const phone = document.querySelector('[name="phone"]').value.trim();
    const address = document.querySelector('[name="address"]').value.trim();

    if (!name || !email || !phone || !address) {
      alert("Please fill out Name, Email, Phone, and Address.");
      return false;
    }
  }

  if (currentStep === 1) {
    const small = parseInt(document.querySelector('[name="small_panes"]').value) || 0;
    const medium = parseInt(document.querySelector('[name="medium_panes"]').value) || 0;
    const large = parseInt(document.querySelector('[name="large_panes"]').value) || 0;

    if (small + medium + large === 0) {
      alert("Please enter at least one pane (small, medium, or large).");
      return false;
    }
  }

  return true;
}

  
</script>
</body>
</html>
